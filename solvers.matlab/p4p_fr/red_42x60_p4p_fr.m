% Input: coefficient matrix C of size 4x20
% Output: solution matrix S of size 4x18

function S = red_42x60_p4p_fr(C)

    M = sparse([1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,41,41,41,41,41,41,41,41,41,41,42,42,42,42,42,42,42,42,42,42],[1,2,3,5,6,8,16,18,21,30,2,3,4,6,7,9,18,43,46,53,5,6,7,8,9,10,21,23,33,46,11,12,13,16,18,21,26,30,35,49,12,13,14,18,43,46,49,50,53,57,15,17,19,20,22,29,32,36,45,52,16,18,21,23,30,33,37,43,46,53,17,19,44,45,47,48,52,54,55,59,20,22,24,32,34,38,45,47,48,55,25,27,28,29,31,32,36,39,52,56,26,30,33,35,37,40,49,50,53,57,27,28,51,52,54,55,56,58,59,60,29,32,34,36,38,41,52,54,55,59,31,36,38,39,41,42,56,58,59,60,1,2,3,5,6,8,15,16,17,18,19,20,21,22,29,30,32,36,45,52,2,3,4,6,7,9,17,18,19,43,44,45,46,47,48,52,53,54,55,59,5,6,7,8,9,10,20,21,22,23,24,32,33,34,38,45,46,47,48,55,11,12,13,16,18,21,25,26,27,28,29,30,31,32,35,36,39,49,52,56,12,13,14,18,27,28,43,46,49,50,51,52,53,54,55,56,57,58,59,60,16,18,21,23,29,30,32,33,34,36,37,38,41,43,46,52,53,54,55,59,26,30,31,33,35,36,37,38,39,40,41,42,49,50,53,56,57,58,59,60,1,2,3,5,6,8,15,16,17,18,19,20,21,22,29,30,32,36,45,52,2,3,4,6,7,9,17,18,19,43,44,45,46,47,48,52,53,54,55,59,5,6,7,8,9,10,20,21,22,23,24,32,33,34,38,45,46,47,48,55,11,12,13,16,18,21,25,26,27,28,29,30,31,32,35,36,39,49,52,56,12,13,14,18,27,28,43,46,49,50,51,52,53,54,55,56,57,58,59,60,16,18,21,23,29,30,32,33,34,36,37,38,41,43,46,52,53,54,55,59,26,30,31,33,35,36,37,38,39,40,41,42,49,50,53,56,57,58,59,60,1,2,3,5,6,8,16,18,21,30,2,3,4,6,7,9,18,43,46,53,5,6,7,8,9,10,21,23,33,46,11,12,13,16,18,21,26,30,35,49,12,13,14,18,43,46,49,50,53,57,15,17,19,20,22,29,32,36,45,52,16,18,21,23,30,33,37,43,46,53,17,19,44,45,47,48,52,54,55,59,20,22,24,32,34,38,45,47,48,55,25,27,28,29,31,32,36,39,52,56,26,30,33,35,37,40,49,50,53,57,27,28,51,52,54,55,56,58,59,60,29,32,34,36,38,41,52,54,55,59,31,36,38,39,41,42,56,58,59,60],C([25,33,41,45,53,57,61,69,73,77,25,33,41,45,53,57,61,69,73,77,25,33,41,45,53,57,61,73,77,69,25,33,41,45,53,57,61,73,77,69,25,33,41,45,53,57,61,69,73,77,25,33,41,45,57,61,73,77,53,69,25,33,45,57,61,73,77,41,53,69,25,33,41,45,53,57,61,69,73,77,25,45,57,61,73,77,33,41,53,69,25,33,41,45,61,57,73,77,53,69,25,45,57,61,73,77,33,41,53,69,25,33,41,45,53,57,61,69,73,77,25,45,57,61,73,77,33,41,53,69,25,45,57,61,73,77,33,41,53,69,2,6,10,14,18,22,26,30,34,38,42,46,50,58,62,66,74,78,54,70,2,6,10,14,18,22,26,30,34,38,42,46,50,54,58,62,66,70,74,78,2,6,10,14,18,22,26,30,46,50,58,62,66,74,78,34,38,42,54,70,2,6,10,14,18,22,26,30,34,42,46,50,62,58,66,74,78,38,54,70,2,6,10,14,26,34,18,22,30,38,42,46,50,54,58,62,66,70,74,78,2,6,14,22,26,30,46,50,58,62,66,74,78,10,18,34,38,42,54,70,2,14,26,22,30,46,50,58,62,66,74,78,6,10,18,34,38,42,54,70,3,7,11,15,19,23,27,31,35,39,43,47,51,59,63,67,75,79,55,71,3,7,11,15,19,23,27,31,35,39,43,47,51,55,59,63,67,71,75,79,3,7,11,15,19,23,27,31,47,51,59,63,67,75,79,35,39,43,55,71,3,7,11,15,19,23,27,31,35,43,47,51,63,59,67,75,79,39,55,71,3,7,11,15,27,35,19,23,31,39,43,47,51,55,59,63,67,71,75,79,3,7,15,23,27,31,47,51,59,63,67,75,79,11,19,35,39,43,55,71,3,15,27,23,31,47,51,59,63,67,75,79,7,11,19,35,39,43,55,71,28,36,44,48,56,60,64,72,76,80,28,36,44,48,56,60,64,72,76,80,28,36,44,48,56,60,64,76,80,72,28,36,44,48,56,60,64,76,80,72,28,36,44,48,56,60,64,72,76,80,28,36,44,48,60,64,76,80,56,72,28,36,48,60,64,76,80,44,56,72,28,36,44,48,56,60,64,72,76,80,28,48,60,64,76,80,36,44,56,72,28,36,44,48,64,60,76,80,56,72,28,48,60,64,76,80,36,44,56,72,28,36,44,48,56,60,64,72,76,80,28,48,60,64,76,80,36,44,56,72,28,48,60,64,76,80,36,44,56,72]),42,60);

    [L,~,p] = lu(M(:,1:31),'vector');
    M = M(p(end-10:end),32:end)-L(end-10:end,:)*(L(1:31,:)\M(p(1:31),32:end));
    %[M,~] = qr(M(:,1:31),M(:,32:end));
    %M = M(end-10:end,:);

    T0 = zeros(18);
    T0([3,4,6,7,10,11,13,14,15,17,18],:) = -M(:,12:end);
    T0([181,200,221,260,279,300,322]) = 1;
    T1 = zeros(18);
    T1([3,4,6,7,10,11,13,14,15,17,18],[3,4,6,7,10,11,13,14,15,17,18]) = M(:,1:11);
    T1([1,20,77,134,153,210,286]) = 1;

    [V,~] = eig(T0,T1);
    S = V(14:17,:)./repmat(V(18,:),4,1);
    S = S(:,all(isfinite(S)));

end