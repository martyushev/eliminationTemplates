% Input: coefficient matrix C of size 10x21
% Output: solution matrix S of size 5x12

function S = red_40x52_gp4p_scale(C)

    M = sparse([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40],[26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,4,5,6,10,11,12,14,17,18,20,23,27,28,30,33,37,44,49,7,8,9,10,11,12,13,14,15,19,20,21,24,29,30,31,34,38,41,45,50,16,17,18,19,20,21,22,23,24,25,32,33,34,35,39,42,43,44,45,46,51],C([21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,1,11,21,31,41,51,61,71,81,91,111,121,131,141,161,171,181,191,201,101,151,1,11,21,31,41,51,71,81,91,111,121,131,141,161,171,181,191,201,61,101,151,21,41,51,71,81,91,111,121,131,141,161,171,181,191,201,1,11,31,61,101,151,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,2,12,22,32,42,52,62,72,82,92,112,122,132,142,162,172,182,192,202,102,152,2,12,22,32,42,52,72,82,92,112,122,132,142,162,172,182,192,202,62,102,152,22,42,52,72,82,92,112,122,132,142,162,172,182,192,202,2,12,32,62,102,152,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,3,13,23,33,43,53,63,73,83,93,113,123,133,143,163,173,183,193,203,103,153,3,13,23,33,43,53,73,83,93,113,123,133,143,163,173,183,193,203,63,103,153,23,43,53,73,83,93,113,123,133,143,163,173,183,193,203,3,13,33,63,103,153,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,4,14,24,34,44,54,64,74,84,94,114,124,134,144,164,174,184,194,204,104,154,4,14,24,34,44,54,74,84,94,114,124,134,144,164,174,184,194,204,64,104,154,24,44,54,74,84,94,114,124,134,144,164,174,184,194,204,4,14,34,64,104,154,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,5,15,25,35,45,55,65,75,85,95,115,125,135,145,165,175,185,195,205,105,155,5,15,25,35,45,55,75,85,95,115,125,135,145,165,175,185,195,205,65,105,155,25,45,55,75,85,95,115,125,135,145,165,175,185,195,205,5,15,35,65,105,155,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,6,16,26,36,46,56,66,76,86,96,116,126,136,146,166,176,186,196,206,106,156,6,16,26,36,46,56,76,86,96,116,126,136,146,166,176,186,196,206,66,106,156,26,46,56,76,86,96,116,126,136,146,166,176,186,196,206,6,16,36,66,106,156,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,7,17,27,37,47,57,67,77,87,97,117,127,137,147,167,177,187,197,207,107,157,7,17,27,37,47,57,77,87,97,117,127,137,147,167,177,187,197,207,67,107,157,27,47,57,77,87,97,117,127,137,147,167,177,187,197,207,7,17,37,67,107,157,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,8,18,28,38,48,58,68,78,88,98,118,128,138,148,168,178,188,198,208,108,158,8,18,28,38,48,58,78,88,98,118,128,138,148,168,178,188,198,208,68,108,158,28,48,58,78,88,98,118,128,138,148,168,178,188,198,208,8,18,38,68,108,158,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,9,19,29,39,49,59,69,79,89,99,119,129,139,149,169,179,189,199,209,109,159,9,19,29,39,49,59,79,89,99,119,129,139,149,169,179,189,199,209,69,109,159,29,49,59,79,89,99,119,129,139,149,169,179,189,199,209,9,19,39,69,109,159,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160,10,20,30,40,50,60,70,80,90,100,120,130,140,150,170,180,190,200,210,110,160,10,20,30,40,50,60,80,90,100,120,130,140,150,170,180,190,200,210,70,110,160,30,50,60,80,90,100,120,130,140,150,170,180,190,200,210,10,20,40,70,110,160]),40,52);

    [L,~,p] = lu(M(:,1:30),'vector');
    M = M(p(end-9:end),31:end)-L(end-9:end,:)*(L(1:30,:)\M(p(1:30),31:end));
    %[M,~] = qr(M(:,1:30),M(:,31:end));
    %M = M(end-9:end,:);

    T0 = zeros(12);
    T0([1,3,4,5,6,8,9,10,11,12],:) = -M(:,11:end);
    T0([122,139]) = 1;
    T1 = zeros(12);
    T1([1,3,4,5,6,8,9,10,11,12],[1,3,4,5,6,8,9,10,11,12]) = M(:,1:10);
    T1([14,79]) = 1;

    [V,~] = eig(T0,T1);
    S = V(7:11,:)./repmat(V(12,:),5,1);
    S = S(:,all(isfinite(S)));

end