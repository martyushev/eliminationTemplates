% Input: coefficient matrix C of size 3x10
% Output: solution matrix S of size 3x10

function S = red_18x28_toa2d_33(C)

    M = sparse([1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18],[1,3,4,5,6,11,12,19,21,26,2,5,6,12,13,20,21,22,27,11,12,13,14,15,21,25,26,27,28,8,9,10,11,12,14,19,24,26,3,7,8,9,23,24,25,26,27,28,10,14,15,16,17,18,23,24,26,28,1,3,4,5,6,11,12,19,21,26,2,5,6,12,13,20,21,22,27,11,12,13,14,15,21,25,26,27,28,8,9,10,11,12,14,19,24,26,3,7,8,9,23,24,25,26,27,28,10,14,15,16,17,18,23,24,26,28,1,3,4,5,6,11,12,19,21,26,2,5,6,12,13,20,21,22,27,11,12,13,14,15,21,25,26,27,28,8,9,10,11,12,14,19,24,26,3,7,8,9,23,24,25,26,27,28,10,14,15,16,17,18,23,24,26,28],C([1,4,10,16,19,25,28,7,13,22,1,10,16,25,28,4,7,13,22,10,16,19,25,28,1,4,7,13,22,4,7,25,16,19,28,1,22,13,1,4,7,10,22,25,13,16,19,28,10,16,19,22,25,28,4,7,1,13,2,5,11,17,20,26,29,8,14,23,2,11,17,26,29,5,8,14,23,11,17,20,26,29,2,5,8,14,23,5,8,26,17,20,29,2,23,14,2,5,8,11,23,26,14,17,20,29,11,17,20,23,26,29,5,8,2,14,3,6,12,18,21,27,30,9,15,24,3,12,18,27,30,6,9,15,24,12,18,21,27,30,3,6,9,15,24,6,9,27,18,21,30,3,24,15,3,6,9,12,24,27,15,18,21,30,12,18,21,24,27,30,6,9,3,15]),18,28);

    [L,~,p] = lu(M(:,1:10),'vector');
    M = M(p(end-7:end),11:end)-L(end-7:end,:)*(L(1:10,:)\M(p(1:10),11:end));
    %[M,~] = qr(M(:,1:10),M(:,11:end));
    %M = M(end-7:end,:);

    T0 = zeros(10);
    T0([1,3,4,8,9,5,6,10],:) = -M(:,9:end);
    T0([82,97]) = 1;
    T1 = zeros(10);
    T1([1,3,4,8,9,5,6,10],[1,3,4,8,9,5,6,10]) = M(:,1:8);
    T1([12,67]) = 1;

    [V,~] = eig(T0,T1);
    S = V(7:9,:)./repmat(V(10,:),3,1);
    S = S(:,all(isfinite(S)));

end