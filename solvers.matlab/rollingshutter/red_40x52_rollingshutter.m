% Input: coefficient matrix C of size 10x21
% Output: solution matrix S of size 5x12

function S = red_40x52_rollingshutter(C)

    M = sparse([1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,4,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,6,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,7,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,8,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,9,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,10,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,11,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,12,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,13,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,17,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,18,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,19,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,20,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,21,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,22,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,23,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,24,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,25,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,26,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,27,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,29,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,31,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,32,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,33,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,34,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,36,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40],[26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,47,48,49,50,51,52,1,2,3,5,6,8,11,12,14,17,18,20,23,26,27,29,33,36,41,44,47,2,3,4,6,7,9,12,13,15,18,19,21,24,27,28,30,34,37,42,45,48,5,6,7,8,9,10,14,15,16,20,21,22,25,29,30,31,35,38,43,46,49],C([1,11,21,31,41,51,141,101,111,121,151,161,171,191,201,61,71,81,91,131,181,1,11,21,31,41,51,61,71,81,101,111,121,141,151,161,171,191,201,91,131,181,1,11,21,31,41,51,61,71,81,101,111,121,141,151,161,171,191,201,91,131,181,1,11,21,31,41,51,61,71,81,101,111,121,141,151,161,171,191,201,91,131,181,2,12,22,32,42,52,142,102,112,122,152,162,172,192,202,62,72,82,92,132,182,2,12,22,32,42,52,62,72,82,102,112,122,142,152,162,172,192,202,92,132,182,2,12,22,32,42,52,62,72,82,102,112,122,142,152,162,172,192,202,92,132,182,2,12,22,32,42,52,62,72,82,102,112,122,142,152,162,172,192,202,92,132,182,3,13,23,33,43,53,143,103,113,123,153,163,173,193,203,63,73,83,93,133,183,3,13,23,33,43,53,63,73,83,103,113,123,143,153,163,173,193,203,93,133,183,3,13,23,33,43,53,63,73,83,103,113,123,143,153,163,173,193,203,93,133,183,3,13,23,33,43,53,63,73,83,103,113,123,143,153,163,173,193,203,93,133,183,4,14,24,34,44,54,144,104,114,124,154,164,174,194,204,64,74,84,94,134,184,4,14,24,34,44,54,64,74,84,104,114,124,144,154,164,174,194,204,94,134,184,4,14,24,34,44,54,64,74,84,104,114,124,144,154,164,174,194,204,94,134,184,4,14,24,34,44,54,64,74,84,104,114,124,144,154,164,174,194,204,94,134,184,5,15,25,35,45,55,145,105,115,125,155,165,175,195,205,65,75,85,95,135,185,5,15,25,35,45,55,65,75,85,105,115,125,145,155,165,175,195,205,95,135,185,5,15,25,35,45,55,65,75,85,105,115,125,145,155,165,175,195,205,95,135,185,5,15,25,35,45,55,65,75,85,105,115,125,145,155,165,175,195,205,95,135,185,6,16,26,36,46,56,146,106,116,126,156,166,176,196,206,66,76,86,96,136,186,6,16,26,36,46,56,66,76,86,106,116,126,146,156,166,176,196,206,96,136,186,6,16,26,36,46,56,66,76,86,106,116,126,146,156,166,176,196,206,96,136,186,6,16,26,36,46,56,66,76,86,106,116,126,146,156,166,176,196,206,96,136,186,7,17,27,37,47,57,147,107,117,127,157,167,177,197,207,67,77,87,97,137,187,7,17,27,37,47,57,67,77,87,107,117,127,147,157,167,177,197,207,97,137,187,7,17,27,37,47,57,67,77,87,107,117,127,147,157,167,177,197,207,97,137,187,7,17,27,37,47,57,67,77,87,107,117,127,147,157,167,177,197,207,97,137,187,8,18,28,38,48,58,148,108,118,128,158,168,178,198,208,68,78,88,98,138,188,8,18,28,38,48,58,68,78,88,108,118,128,148,158,168,178,198,208,98,138,188,8,18,28,38,48,58,68,78,88,108,118,128,148,158,168,178,198,208,98,138,188,8,18,28,38,48,58,68,78,88,108,118,128,148,158,168,178,198,208,98,138,188,9,19,29,39,49,59,149,109,119,129,159,169,179,199,209,69,79,89,99,139,189,9,19,29,39,49,59,69,79,89,109,119,129,149,159,169,179,199,209,99,139,189,9,19,29,39,49,59,69,79,89,109,119,129,149,159,169,179,199,209,99,139,189,9,19,29,39,49,59,69,79,89,109,119,129,149,159,169,179,199,209,99,139,189,10,20,30,40,50,60,150,110,120,130,160,170,180,200,210,70,80,90,100,140,190,10,20,30,40,50,60,70,80,90,110,120,130,150,160,170,180,200,210,100,140,190,10,20,30,40,50,60,70,80,90,110,120,130,150,160,170,180,200,210,100,140,190,10,20,30,40,50,60,70,80,90,110,120,130,150,160,170,180,200,210,100,140,190]),40,52);

    [L,~,p] = lu(M(:,1:32),'vector');
    M = M(p(end-7:end),33:end)-L(end-7:end,:)*(L(1:32,:)\M(p(1:32),33:end));
    %[M,~] = qr(M(:,1:32),M(:,33:end));
    %M = M(end-7:end,:);

    T0 = zeros(12);
    T0([4,5,6,7,8,9,11,12],:) = -M(:,9:end);
    T0([73,86,99,142]) = 1;
    T1 = zeros(12);
    T1([4,5,6,7,8,9,11,12],[4,5,6,7,8,9,11,12]) = M(:,1:8);
    T1([1,14,27,118]) = 1;

    [V,~] = eig(T0,T1);
    S = V(7:11,:)./repmat(V(12,:),5,1);
    S = S(:,all(isfinite(S)));

end